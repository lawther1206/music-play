import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as N,a as A,b as p,c as F,d as P,e as i,m as d,f as t,g as u,t as w,q as j,E as b,p as q,l as z}from"./index-3o9WYePx.js";const y=r=>(q("data-v-44d47afd"),r=r(),z(),r),M={class:"update-card"},T={class:"update-img"},G=["src"],H={class:"update-img-text"},J={class:"mb5"},K={class:"mb8"},O=["onClick"],Q=y(()=>t("div",{class:"el-upload__text"},[d("将文件拖到此处，或"),t("em",null,"点击上传")],-1)),W=y(()=>t("div",{class:"el-upload__tip"},[d("请上传分辨率大于 "),t("span",{class:"bold-red"},"500x500"),d(" 的图片")],-1)),X={class:"dialog-footer"},Y={__name:"index",props:{multiple:{type:Boolean,default:!1}},emits:["getUrl"],setup(r,{expose:V,emit:k}){const L=N(),U=k,h=r,e=A({loading:!1,dialogUploadVisible:!1,fileList:[]}),C=()=>{e.dialogUploadVisible=!0},I=async(a,o)=>{let s=[];o.forEach(n=>{s.push(R(n,500,500))}),Promise.all(s).then(()=>{e.fileList=o})},E=a=>{e.fileList=e.fileList.filter(o=>o.uid!=a.uid)},D=async()=>{if(e.fileList.length<1){b.warning("请先上传图片");return}if(e.fileList.find(s=>s.valid==!1))return b.warning("存在不合格图片,请删除后重新尝试！");let o=null;e.loading=!0;try{if(h.multiple){let s=e.fileList.map(n=>n.raw)}else{let s=e.fileList[0].raw}b.success("上传成功"),U("getUrl",o),e.dialogUploadVisible=!1,e.loading=!1}catch{e.loading=!1}},R=(a,o,s)=>new Promise((n,g)=>{const c=new FileReader;c.onload=function(_){var v;const l=new Image;l.onload=function(){var x;const m=this.width,f=this.height;a.width=m,a.height=f,a.url=(x=_.target)==null?void 0:x.result,m<o&&f<s?(a.valid=!1,n({valid:!1,width:m,height:f})):(a.valid=!0,n({valid:!0,width:m,height:f}))},l.onerror=function(){g(new Error("无法加载图像"))},l.src=(v=_.target)==null?void 0:v.result},c.onerror=function(){g(new Error("读取文件出错"))},c.readAsDataURL(a.raw)}),S=()=>{e.dialogUploadVisible=!1},B=()=>{e.fileList=[]};return V({openDialog:C}),(a,o)=>{const s=p("el-tag"),n=p("el-icon"),g=p("el-upload"),c=p("el-button"),_=p("el-dialog");return F(),P(_,{modelValue:e.dialogUploadVisible,"onUpdate:modelValue":o[0]||(o[0]=l=>e.dialogUploadVisible=l),"lock-scroll":!1,draggable:"",width:"400px",onClose:o[1]||(o[1]=l=>B())},{header:i(()=>[d(" 上传文件 ")]),footer:i(()=>[t("span",X,[u(c,{onClick:S},{default:i(()=>[d("取消")]),_:1}),u(c,{type:"primary",onClick:D,loading:e.loading},{default:i(()=>[d("确定")]),_:1},8,["loading"])])]),default:i(()=>[t("div",null,[u(g,{multiple:h.multiple,limit:h.multiple?100:1,ref_key:"uploadRef",ref:L,drag:"","auto-upload":!1,"file-list":e.fileList,action:"","on-change":I,accept:".jpg,.jpeg,.png,.gif,.webp"},{file:i(({file:l})=>[t("div",M,[t("div",T,[t("img",{class:"update-img-item",src:l.url,alt:""},null,8,G),t("div",H,[t("div",J,w(l.name),1),t("div",K,"分辨率: "+w(`${l.width}*${l.height}`),1),t("div",null,[u(s,{type:l.valid?"success":"danger"},{default:i(()=>[d(w(l.valid?"合格":"不合格"),1)]),_:2},1032,["type"])])]),t("div",{class:"update-img-icon",style:j({backgroundColor:l.valid?"#67c23a":"#DE2910"})},null,4),t("i",{class:"icon-close",onClick:v=>E(l)},"x",8,O)])])]),tip:i(()=>[W]),default:i(()=>[u(n,{class:"el-icon--upload"},{default:i(()=>[d(" 📁 ")]),_:1}),Q]),_:1},8,["multiple","limit","file-list"])])]),_:1},8,["modelValue"])}}},le=$(Y,[["__scopeId","data-v-44d47afd"]]);export{le as default};
